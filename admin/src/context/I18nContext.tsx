import { createContext, useContext, useEffect, useState, type ReactNode } from "react";

type Language = "en" | "ar";

const translations: Record<Language, Record<string, string>> = {
  en: {
    // navigation
    "nav.dashboard": "Dashboard",
    "nav.products": "Products",
    "nav.categories": "Categories",
    "nav.orders": "Orders",
    "nav.users": "Users",
    "nav.wallet": "Wallet Top-ups",
    "nav.announcements": "Announcements",
    "nav.coupons": "Coupons",
    "nav.branches": "Branches",
    "nav.settings": "Settings",
    "nav.audit": "Audit Logs",
    shopicoAdminPanel:"Shopico Admin Panel",
    logout: "Logout",
    // common
    filter: "Filter",
    clear: "Clear",
    save: "Save",
    apply: "Apply",
    cancel: "Cancel",
    close: "Close",
    delete: "Delete",
    edit: "Edit",
    view: "View",
    approve: "Approve",
    reject: "Reject",
    confirmPayment: "Confirm Payment",
    addProduct: "Add product",
    addCategory: "Add category",
    addAnnouncement: "Add announcement",
    addCoupon: "Add coupon",
    promote: "Promote",
    active: "Active",
    inactive: "Inactive",
    images: "Images",
    image: "Image",
    name: "Name",
    description: "Description",
    category: "Category",
    price: "Price",
    promoStatus: "Promo",
    oldPrice: "Old price",
    newPrice: "New price",
    priceChange: "Price change",
    availability: "Availability",
    available: "Available",
    unavailable: "Unavailable",
    status: "Status",
    payment: "Payment",
    total: "Total",
    amount: "Amount",
    method: "Method",
    customer: "Customer",
    email: "Email",
    role: "Role",
    membership: "Membership",
    permissions: "Permissions",
    savePermissions: "Save permissions",
    permissionsUpdated: "Permissions updated",
    noPermissionTitle: "No access",
    noPermissionBody: "You do not have permission to view this page.",
    noPermissionAction: "No permission",
    "role.customer": "Customer",
    "role.admin": "Admin",
    "role.manager": "Manager",
    "role.staff": "Staff",
    "perm.group.general": "General",
    "perm.group.catalog": "Catalog",
    "perm.group.orders": "Orders & Wallet",
    "perm.group.marketing": "Marketing",
    "perm.group.users": "Users",
    "perm.group.settings": "Settings",
    "perm.group.branches": "Branches",
    "perm.dashboard.view": "View dashboard",
    "perm.audit.view": "View audit logs",
    "perm.products.view": "View products",
    "perm.products.manage": "Manage products",
    "perm.products.import": "Import products",
    "perm.categories.view": "View categories",
    "perm.categories.manage": "Manage categories",
    "perm.uploads.auth": "Upload images",
    "perm.orders.view": "View orders",
    "perm.orders.update": "Update orders",
    "perm.wallet.topups.view": "View wallet top-ups",
    "perm.wallet.topups.create": "Create top-up requests",
    "perm.wallet.manage": "Manage wallet top-ups",
    "perm.announcements.view": "View announcements",
    "perm.announcements.manage": "Manage announcements",
    "perm.coupons.view": "View coupons",
    "perm.coupons.manage": "Manage coupons",
    "perm.users.view": "View users",
    "perm.users.manage": "Manage users",
    "perm.settings.view": "View settings",
    "perm.settings.manage": "Manage settings",
    "perm.branches.view": "View branches",
    "perm.branches.manage": "Manage branches",
    "perm.branches.assign": "Assign users to branches",
    searchName: "Search name",
    searchNameEmail: "Search name or email",
    searchUser: "Search user/email/order",
    searchTopup: "Search user/email",
    searchCategory: "Search name or description",
    searchAnnouncements: "Search title/description/link",
    searchProducts: "Search products",
    searchLevels: "Search levels",
    searchCoupons: "Search code/title/description/user",
    searchUsers: "Search users",
    selectAll: "Select all",
    clearAll: "Clear all",
    page: "Page",
    of: "of",
    prev: "Previous",
    next: "Next",
    selected: "Selected",
    noResults: "No results",
    yes: "Yes",
    no: "No",
    consumed: "Consumed",
    changeCategories: "Change categories",
    changeAssigned: "Change assigned",
    changePrices: "Change prices",
    changeType: "Change type",
    increase: "Increase",
    amountType: "Amount type",
    invalidAmount: "Enter a valid amount",
    invalidForm: "Please fill all required fields",
    maxDiscount: "Percentage discount cannot exceed 100",
    saving: "Saving...",
    upload: "Upload",
    import: "Import",
    importProducts: "Import Excel",
    importProductsHint: "Upload an Excel file to sync products.",
    selectFile: "Select file",
    showChangesOnly: "Show changes only",
    reason: "Reason",
    action: "Action",
    importSummary: "Created {created}, updated {updated}, skipped {skipped} of {total}.",
    importPreviewSummaryPrefix:"Preview",
    importPreviewSummary: "{created} new, {updated} updates, {skipped} skipped of {total}.",
    "import.action.create": "Create",
    "import.action.update": "Update",
    "import.action.skip": "Skip",
    "import.reason.missing_barcode_or_price": "Missing barcode or price",
    "import.reason.missing_name": "Missing name",
    "import.reason.no_stock_new": "No stock for new product",
    "import.reason.no_change": "No changes detected",
    "import.reason.new_product": "New product",
    "import.reason.updated_fields": "Changed",
    "import.field.name": "name",
    "import.field.price": "price",
    "import.field.availability": "availability",
    "titles.orders": "Orders",
    "titles.wallet": "Top-up approvals",
    "titles.users": "Users",
    "titles.userDetail": "User Details",
    "titles.settings": "Settings",
    walletBalance: "Wallet Balance",
    points: "Points",
    walletLedger: "Wallet Ledger",
    pointsLedger: "Points Ledger",
    topUpWallet: "Top up wallet",
    topUp: "Top up",
    note: "Note",
    addresses: "Addresses",
    address: "Address",
    noAddresses: "No addresses",
    noPhone:"No phone number",
    noOrders: "No orders",
    noOrdersYet: "No orders yet",
    noTopups: "No topups",
    noCategories: "No categories",
    newCategory: "New Category",
    newProduct: "New Product",
    newAnnouncement: "New Announcement",
    newCoupon: "New Coupon",
    announcementsHint: "Manage announcement popups in the app.",
    title: "Title",
    link: "Link",
    from: "From",
    till: "Till",
    enabled: "Enabled",
    code: "Code",
    discount: "Discount",
    discountCoupon: "Discount coupon",
    usage: "Usage",
    used: "Used",
    expires: "Expires",
    assignedTo: "Assigned to",
    assignedProducts: "Products",
    assignedLevels: "Membership levels",
    changeProducts: "Change products",
    changeLevels: "Change levels",
    restricted: "Restricted",
    assignmentType: "Assignment",
    assignmentRestricted: "Restricted",
    assignmentUsers: "Users",
    assignmentProducts: "Products",
    assignmentLevels: "Levels",
    percent: "Percent",
    fixed: "Fixed",
    singleUse: "Single",
    multiUse: "Multiple",
    maxUsesScope: "Uses scope",
    perUser: "Per user",
    global: "Global",
    maxUsesPerUser: "Max per user",
    maxUsesGlobal: "Max global",
    allUsers: "All users",
    freeDelivery: "Free delivery",
    maxUses: "Max uses",
    loginTitle: "Admin Login",
    loginSubtitle: "Use the seeded admin credentials or your own account.",
    emailLabel: "Email",
    passwordLabel: "Password",
    loginButton: "Login",
    signingIn: "Signing in...",
    invalidCredentials: "Invalid credentials",
    // settings
    "settings.operational": "Operational Settings",
    "settings.membership": "Membership Settings",
    storeLat: "Store latitude",
    storeLng: "Store longitude",
    deliveryFreeKm: "Free delivery distance (Km)",
    deliveryRatePerKm: "Delivery rate per Km (SYP)",
    membershipGraceDays: "Membership grace days",
    levelsLabel: "Levels (SYP)",
    "level.silver": "Silver",
    "level.gold": "Gold",
    "level.platinum": "Platinum",
    "level.diamond": "Diamond",
    pointsPerAmount: "Point cost (SYP per point)",
    rewardThresholdPoints: "Reward threshold (points)",
    rewardValue: "Reward value (SYP)",
    allowMultipleCoupons: "Allow multiple coupons",
    saveSettings: "Save Settings",
    loadingSettings: "Loading settings...",
    addUser: "Add user",
    newUser: "New user",
    createUser: "Create user",
    phone: "Phone",
    branches: "Branches",
    addBranch: "Add branch",
    newBranch: "New Branch",
    noBranches: "No branches",
    searchBranch: "Search branch name/address/phone",
    latitude: "Latitude",
    longitude: "Longitude",
    openHours: "Open hours",
    deliveryRadiusKm: "Delivery radius (Km)",
    saveBranches: "Save branches",
    branchesUpdated: "Branches updated",
  },
  ar: {
    // navigation
    "nav.dashboard": "لوحة التحكم",
    "nav.products": "المنتجات",
    "nav.categories": "التصنيفات",
    "nav.orders": "الطلبات",
    "nav.users": "المستخدمون",
    "nav.wallet": "طلبات الشحن",
    "nav.settings": "الإعدادات",
    "nav.audit": "سجل التدقيق",
    "nav.branches": "Branches",
    shopicoAdminPanel:"لوحة إدارة شوبيكو",
    logout: "تسجيل الخروج",
    // common
    filter: "تصفية",
    clear: "مسح",
    save: "حفظ",    
    apply: "تطبيق",
    cancel: "إلغاء",
    close: "إغلاق",
    delete: "حذف",
    edit: "تعديل",
    view: "عرض",
    approve: "موافقة",
    reject: "رفض",
    confirmPayment: "تأكيد الدفع",
    addProduct: "إضافة منتج",
    addCategory: "إضافة تصنيف",
    images: "الصور",
    image: "صورة",
    name: "الإسم",
    description: "الوصف",
    category: "التصنيف",
    price: "السعر",
    availability: "التوفر",
    available: "متاح",
    unavailable: "غير متاح",
    status: "الحالة",
    payment: "الدفع",
    total: "الإجمالي",
    amount: "المبلغ",
    method: "الطريقة",
    customer: "العميل",
    email: "البريد الإلكتروني",
    role: "الدور",
    membership: "العضوية",
    permissions: "���������",
    savePermissions: "��� ���������",
    permissionsUpdated: "�� ����� ���������",
    noPermissionTitle: "�� ���� ���",
    noPermissionBody: "��� ���� ������ ���� ��� ������.",
    noPermissionAction: "�� ���� ���",
    "perm.group.general": "���",
    "perm.group.catalog": "��������",
    "perm.group.orders": "������� ��������",
    "perm.group.marketing": "�������",
    "perm.group.users": "����������",
    "perm.group.settings": "���������",
    "perm.group.branches": "Branches",
    "perm.dashboard.view": "��� ���� ������",
    "perm.audit.view": "��� ��� �������",
    "perm.products.view": "��� ��������",
    "perm.products.manage": "����� ��������",
    "perm.products.import": "������� ��������",
    "perm.categories.view": "��� ���������",
    "perm.categories.manage": "����� ���������",
    "perm.uploads.auth": "��� �����",
    "perm.orders.view": "��� �������",
    "perm.orders.update": "����� �������",
    "perm.wallet.topups.view": "عرض شحنات المحفظة",
    "perm.wallet.topups.create": "إنشاء طلبات شحن",
    "perm.wallet.manage": "����� ����� �����",
    "perm.announcements.view": "��� ���������",
    "perm.announcements.manage": "����� ���������",
    "perm.coupons.view": "��� �������",
    "perm.coupons.manage": "����� �������",
    "perm.users.view": "��� ����������",
    "perm.users.manage": "����� ����������",
    "perm.settings.view": "��� ���������",
    "perm.settings.manage": "����� ���������",
    "perm.branches.view": "View branches",
    "perm.branches.manage": "Manage branches",
    "perm.branches.assign": "Assign users to branches",
    "role.customer": "عميل",
    "role.admin": "مسؤول",
    "role.manager": "����",
    "role.staff": "موظف",
    searchName: "ابحث بالإسم",
    searchNameEmail: "ابحث بالإسم أو البريد",
    searchUser: "ابحث عن المستخدم/البريد/الطلب",
    searchTopup: "ابحث عن المستخدم أو البريد",
    searchCategory: "ابحث بالإسم أو الوصف",
    searchAnnouncements: "Search announcements",
    searchCoupons: "???? ??????/???????/?????/????????",
    yes: "نعم",
    no: "لا",
    consumed: "??????",
    changeCategories: "????? ?????????",
    changeAssigned: "????? ????????",
    upload: "رفع",
    import: "�������",
    importProducts: "������� �� ����",
    importProductsHint: "�� ���� ��� ���� ������� ��������.",
    selectFile: "���� �����",
    showChangesOnly: "??? ????????? ???",
    reason: "?????",
    action: "???????",
    importPreviewSummary: "??????: {created} ????? {updated} ?????? {skipped} ???? ?? {total}.",
    "import.action.create": "?????",
    "import.action.update": "?????",
    "import.action.skip": "????",
    "import.reason.missing_barcode_or_price": "??? ?? ??? ?????",
    "import.reason.missing_name": "??? ?????",
    "import.reason.no_stock_new": "?? ???? ???? ?????? ??????",
    "import.reason.no_change": "?? ???? ???????",
    "import.reason.new_product": "???? ????",
    "import.reason.updated_fields": "???????",
    "import.field.name": "?????",
    "import.field.price": "?????",
    "import.field.availability": "??????",
    importSummary: "�� ����� {created} ������ {updated} ����� {skipped} �� ��� {total}.",
    "titles.orders": "الطلبات",
    "titles.wallet": "طلبات الشحن",
    "titles.users": "المستخدمون",
    "titles.userDetail": "تفاصيل المستخدم",
    "titles.settings": "الإعدادات",
    walletBalance: "رصيد المحفظة",
    points: "النقاط",
    walletLedger: "حركات المحفظة",
    pointsLedger: "حركات النقاط",
    topUpWallet: "Top up wallet",
    topUp: "Top up",
    note: "Note",
    addresses: "العناوين",
    address: "Address",
    noAddresses: "لا توجد عناوين",
    noPhone:"لا يوجد رقم",
    noOrders: "لا يوجد طلبات",
    noOrdersYet: "لا يوجد طلبات حتى الآن",
    noTopups: "لا يوجد طلبات شحن",
    noCategories: "لا يوجد تصنيفات",
    newCategory: "إضافة تصنيف جديد",
    newProduct: "إضافة منتج جديد",
    loginTitle: "تسجيل الدخول للوحة التحكم",
    loginSubtitle: "استخدم بيانات المسؤول الافتراضية أو حسابك.",
    emailLabel: "البريد الإلكتروني",
    passwordLabel: "كلمة المرور",
    loginButton: "دخول",
    signingIn: "جاري الدخول...",
    invalidCredentials: "بيانات غير صحيحة",
    invalidForm: "���� ����� ������ ��������",
    // settings
    "settings.operational": "إعدادات التشغيل",
    "settings.membership": "إعدادات العضوية",
    storeLat: "خط العرض للمتجر",
    storeLng: "خط الطول للمتجر",
    deliveryFreeKm: "مسافة التوصيل المجاني (كم)",
    deliveryRatePerKm: "تكلفة التوصيل لكل كم (ل.س)",
    membershipGraceDays: "أيام السماح للعضوية",
    levelsLabel: "مستويات العضوية (ل.س)",
    "level.silver": "فضي",
    "level.gold": "ذهبي",
    "level.platinum": "بلاتيني",
    "level.diamond": "ماسي",
    pointsPerAmount: "تكلفة النقطة (ل.س لكل نقطة)",
    rewardThresholdPoints: "عتبة المكافأة (نقاط)",
    rewardValue: "قيمة المكافأة (ل.س)",
    allowMultipleCoupons: "السماح بعدة قسائم",
    saveSettings: "حفظ الإعدادات",
    loadingSettings: "جار تحميل الإعدادات...",
    addUser: "����� ������",
    newUser: "������ ����",
    createUser: "����� ������",
    phone: "��� ������",
    branches: "Branches",
    addBranch: "Add branch",
    newBranch: "New Branch",
    noBranches: "No branches",
    searchBranch: "Search branch name/address/phone",
    latitude: "Latitude",
    longitude: "Longitude",
    openHours: "Open hours",
    deliveryRadiusKm: "Delivery radius (Km)",
    saveBranches: "Save branches",
    branchesUpdated: "Branches updated",
  },
};

const statusTranslations: Record<string, { en: string; ar: string }> = {
  PENDING: { en: "Pending", ar: "قيد الانتظار" },
  PROCESSING: { en: "Processing", ar: "قيد المعالجة" },
  SHIPPING: { en: "Shipping", ar: "قيد الشحن" },
  DELIVERED: { en: "Delivered", ar: "تم التوصيل" },
  CANCELLED: { en: "Cancelled", ar: "ملغي" },
  APPROVED: { en: "Approved", ar: "مقبول" },
  REJECTED: { en: "Rejected", ar: "مرفوض" },
  CONFIRMED: { en: "Confirmed", ar: "مؤكد" },
};

interface I18nContextValue {
  lang: Language;
  dir: "ltr" | "rtl";
  t: (key: string) => string;
  tStatus: (key: string) => string;
  toggleLanguage: () => void;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export const I18nProvider = ({ children }: { children: ReactNode }) => {
  const [lang, setLang] = useState<Language>((localStorage.getItem("lang") as Language) || "en");
  const dir: "ltr" | "rtl" = lang === "ar" ? "rtl" : "ltr";

  useEffect(() => {
    document.documentElement.setAttribute("dir", dir);
    document.documentElement.setAttribute("lang", lang);
    localStorage.setItem("lang", lang);
  }, [lang, dir]);

  const t = (key: string) => translations[lang][key] || translations.en[key] || key;
  const tStatus = (key: string) => statusTranslations[key]?.[lang] || key;
  const toggleLanguage = () => setLang((prev) => (prev === "en" ? "ar" : "en"));

  return <I18nContext.Provider value={{ lang, dir, t, tStatus, toggleLanguage }}>{children}</I18nContext.Provider>;
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
};
